<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top 3 Soybean Import Share</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
</head>
<body>
    <div id="chart" style="width: 100%; height: 500px;"></div>

    <script>
        const chart = echarts.init(document.getElementById('chart'));

        const jsonUrl = '../data/processed/Q1.1.soybean_imports_quantity_price.json';
        fetch(jsonUrl).then(function(resp){return resp.json();}).then(function(data){
        var startDate = new Date('2024-01-01');
        var filtered = data.filter(function(d){
            var s = d.refMonth;
            var dt = new Date((typeof s === 'string' && s.length === 7) ? (s + '-01') : s);
            return dt >= startDate;
        });
        const months = filtered.map(function(d){return d.refMonth;});
        const total = filtered.map(function(d){return d.Argentina_cif + d.Brazil_cif + d.USA_cif;});
        const gradientOption = {
            color: ['#5470C6', '#91CC75', '#FAC858'],
            title: {
                text: 'Gradient Stacked Area Chart: Top 3 Soybean Import Share (2024-01 to 2025-10)',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label: { backgroundColor: '#6a7985' }
                }
            },
            legend: { data: ['Argentina', 'Brazil', 'USA'], top: 30 },
            toolbox: { feature: { saveAsImage: { name: 'Q1.1.china_soybean_import_share_stacked_area_chart' } } },
            grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
            xAxis: [{ type: 'category', boundaryGap: false, data: months }],
            yAxis: [{ type: 'value', min: 0, max: 100, axisLabel: { formatter: '{value} %' } }],
            series: [
                {
                    name: 'Argentina',
                    type: 'line',
                    stack: 'Total',
                    smooth: true,
                    lineStyle: { width: 0 },
                    showSymbol: false,
                    areaStyle: {
                        opacity: 0.95,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#5A77C8' },
                            { offset: 1, color: '#5470C6' }
                        ])
                    },
                    emphasis: { focus: 'series' },
                    data: filtered.map(function(d, i){return total[i] > 0 ? Number(((d.Argentina_cif / total[i]) * 100).toFixed(2)) : 0;})
                },
                {
                    name: 'Brazil',
                    type: 'line',
                    stack: 'Total',
                    smooth: true,
                    lineStyle: { width: 0 },
                    showSymbol: false,
                    areaStyle: {
                        opacity: 0.95,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#86C57B' },
                            { offset: 1, color: '#91CC75' }
                        ])
                    },
                    emphasis: { focus: 'series' },
                    data: filtered.map(function(d, i){return total[i] > 0 ? Number(((d.Brazil_cif / total[i]) * 100).toFixed(2)) : 0;})
                },
                {
                    name: 'USA',
                    type: 'line',
                    stack: 'Total',
                    smooth: true,
                    lineStyle: { width: 0 },
                    showSymbol: false,
                    areaStyle: {
                        opacity: 0.95,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#F5BD4D' },
                            { offset: 1, color: '#FAC858' }
                        ])
                    },
                    emphasis: { focus: 'series' },
                    data: filtered.map(function(d, i){return total[i] > 0 ? Number(((d.USA_cif / total[i]) * 100).toFixed(2)) : 0;})
                }
            ]
        };
        chart.setOption(gradientOption);
        }).catch(function(err){console.error(err);});
    </script>
</body>
</html>